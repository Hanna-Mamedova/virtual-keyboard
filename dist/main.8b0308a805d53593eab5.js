(()=>{"use strict";var e,t,a=["`","1","2","3","4","5","6","7","8","9","0","-","=","Backspace","Tab","q","w","e","r","t","y","u","i","o","p","[","]","\\","Del","Caps Lock","a","s","d","f","g","h","j","k","l",";","'","Enter","ShiftLeft","z","x","c","v","b","n","m",",",".","/","up","ShiftRight","CtrlLeft","Win","AltLeft","Space","AltRight","left","down","right","CtrlRight"],i=["`","1","2","3","4","5","6","7","8","9","0","-","=","[","]","\\",";","'",",",".","/"],s=["~","!","@","#","$","%","^","&","*","(",")","_","+","{","}","|",":",'"',"<",">","?"],n=["ё","1","2","3","4","5","6","7","8","9","0","-","=","Backspace","Tab","й","ц","у","к","е","н","г","ш","щ","з","х","ъ","\\","Del","Caps Lock","ф","ы","в","а","п","р","о","л","д","ж","э","Enter","ShiftLeft","я","ч","с","м","и","т","ь","б","ю",".","up","ShiftRight","CtrlLeft","Win","AltLeft","Space","AltRight","left","down","right","CtrlRight"];class c{constructor(e){this.value=e}init(){this.keyElement=document.createElement("button"),this.keyElement.setAttribute("type","button"),this.keyElement.classList.add("keyboard__key")}createSpecialKey(e,t,a){this.keyElement.classList.add(...e),this.keyElement.innerHTML=t,this.keyElement.setAttribute("value",a),this.value=a}}!function(e){e.eng="eng",e.rus="rus"}(e||(e={})),function(e){e.up="&#9650",e.down="&#9660",e.left="&#9668",e.right="&#9658"}(t||(t={}));var r;!function(e){e[e.cols=50]="cols",e[e.rows=10]="rows"}(r||(r={}));const o={},l=new class{constructor(){this.value="",this.language=localStorage.getItem("lang")||e.eng,this.capsLockOn=!1,this.shiftOn=!1}init(){const e=document.createElement("div"),t=document.createElement("div");e.classList.add("keyboard"),t.classList.add("keyboard__keys"),t.append(this.createKeys()),this.keys=t.querySelectorAll(".keyboard__key"),e.append(t),document.body.append(e),this.onInput("",(e=>{const t=document.querySelector("textarea");t.value=e,t.focus()}))}createKeys(){const s=document.createDocumentFragment();return this.language&&localStorage.setItem("lang",this.language),this.keyLayout=this.language===e.rus?n:a,this.keyLayout.forEach((e=>{const a=new c(e);a.init();const n=a.keyElement,r=-1!==["Backspace","DEL","ENTER","ShiftRight"].indexOf(e);switch(e){case"Backspace":a.createSpecialKey(["keyboard__key-special-wide"],"Backspace","Backspace"),n.addEventListener("click",(()=>{this.deleteBackSpace()}));break;case"Tab":a.createSpecialKey(["keyboard__key-special"],"Tab","Tab"),n.addEventListener("click",(()=>{this.tab()}));break;case"Del":a.createSpecialKey(["keyboard__key-special"],"Del","Delete"),n.addEventListener("click",(()=>{this.delDelete()}));break;case"Caps Lock":a.createSpecialKey(["keyboard__key-special-wide","CapsLock"],"Caps Lock","CapsLock"),n.addEventListener("click",(()=>{this.capsLock()}));break;case"Enter":a.createSpecialKey(["keyboard__key-special-wide"],"ENTER","Enter"),n.addEventListener("click",(()=>{this.enter()}));break;case"ShiftRight":a.createSpecialKey(["keyboard__key-special-wide"],"Shift","ShiftRight"),n.addEventListener("mousedown",(()=>{this.toggleShift()})),n.addEventListener("mouseup",(()=>{this.toggleShift()}));break;case"ShiftLeft":a.createSpecialKey(["keyboard__key-special-wide"],"Shift","ShiftLeft"),n.addEventListener("mousedown",(()=>{this.toggleShift()})),n.addEventListener("mouseup",(()=>{this.toggleShift()}));break;case"Space":a.createSpecialKey(["keyboard__key-space"],"","Space"),n.addEventListener("click",(()=>{this.space()}));break;case"up":a.createSpecialKey(["keyboard__key-special","ArrowUp"],t.up,"ArrowUp"),n.addEventListener("click",(()=>{this.ordinaryKey(a.keyElement.innerHTML)}));break;case"down":a.createSpecialKey(["keyboard__key-special","ArrowDown"],t.down,"ArrowDown"),n.addEventListener("click",(()=>{this.ordinaryKey(a.keyElement.innerHTML)}));break;case"left":a.createSpecialKey(["keyboard__key-special","ArrowLeft"],t.left,"ArrowLeft"),n.addEventListener("click",(()=>{this.ordinaryKey(a.keyElement.innerHTML)}));break;case"right":a.createSpecialKey(["keyboard__key-special","ArrowRight"],t.right,"ArrowRight"),n.addEventListener("click",(()=>{this.ordinaryKey(a.keyElement.innerHTML)}));break;case"CtrlLeft":a.createSpecialKey(["keyboard__key-special"],"ctrl","ControlLeft");break;case"CtrlRight":a.createSpecialKey(["keyboard__key-special"],"ctrl","ControlRight");break;case"AltLeft":a.createSpecialKey(["keyboard__key-special"],"alt","AltLeft");break;case"AltRight":a.createSpecialKey(["keyboard__key-special"],"alt","AltRight");break;case"Win":a.createSpecialKey(["keyboard__key-special"],"win","MetaLeft");break;default:a.value=e.toLowerCase(),n.textContent=a.value,i.includes(n.textContent)?n.classList.add("changeKey"):n.classList.add("changeCase"),n.addEventListener("click",(()=>{this.capsLockOn&&!this.shiftOn?this.ordinaryKey(e.toUpperCase()):this.ordinaryKey(e.toLowerCase())}))}s.append(n),r&&s.append(document.createElement("br"))})),s}triggerEvent(e){"function"==typeof e&&e(this.value)}onInput(e,t){this.value=e||"",this.oninput=t}deleteBackSpace(){const e=document.querySelector("textarea"),t=e.selectionStart;this.value=this.value.slice(0,t-1)+this.value.slice(t),this.triggerEvent(this.oninput),e.selectionEnd=t-1}tab(){this.insertEl("    ",4),this.triggerEvent(this.oninput)}delDelete(){const e=document.querySelector("textarea"),t=e.selectionStart;this.value=this.value.slice(0,t)+this.value.slice(t+1),this.triggerEvent(this.oninput),e.selectionEnd=t}capsLock(){this.capsLockOn=!this.capsLockOn;const e=document.querySelector(".CapsLock");this.capsLockOn?e.classList.add("keyboard__key--active"):e.classList.remove("keyboard__key--active"),this.changeKeyCase()}enter(){this.insertEl("\n",1),this.triggerEvent(this.oninput)}space(){this.insertEl(" ",1),this.triggerEvent(this.oninput)}ordinaryKey(e){this.insertEl(e,1),this.triggerEvent(this.oninput)}insertEl(e,t){const a=document.querySelector("textarea"),i=a.selectionStart,s=this.value.split("");s.splice(i,0,e),this.value=s.join(""),this.triggerEvent(this.oninput),a.selectionEnd=i+t}changeKeyCase(){for(const e of this.keys)e.classList.contains("changeCase")&&(e.textContent=this.capsLockOn&&!this.shiftOn||this.shiftOn&&!this.capsLockOn?e.textContent.toUpperCase():e.textContent.toLowerCase())}changeSpecialKeys(){for(const e of this.keys)e.classList.contains("changeKey")&&(e.textContent=this.shiftOn?s[i.indexOf(e.textContent)]:i[s.indexOf(e.textContent)])}toggleShift(){this.shiftOn=!this.shiftOn,this.changeKeyCase(),this.changeSpecialKeys()}highlightKey(e,t){for(const a of this.keys)(a.getAttribute("value")===t||"`"===a.textContent&&"Backquote"===t||"'"===a.textContent&&"Quote"===t||a.textContent===e||a.textContent===t)&&a.classList.add("keyboard__key--active")}removeKeyHighlight(e,t){for(const a of this.keys)(a.getAttribute("value")===t||"`"===a.textContent&&"Backquote"===t||"'"===a.textContent&&"Quote"===t||a.textContent===e||a.textContent===t)&&a.classList.remove("keyboard__key--active")}switchLanguage(){this.language===e.eng?this.language=e.rus:this.language=e.eng,localStorage.setItem("lang",this.language);const t=document.querySelector(".keyboard__keys");t.innerHTML="",t.append(this.createKeys()),this.keys=t.querySelectorAll(".keyboard__key")}};function h(e,t,a){const i=document.createElement(e);i.innerHTML=t,i.setAttribute("id",a),document.body.append(i)}window.onload=()=>{h("h1","VIRTUAL KEYBOARD"),function(){const e=document.createElement("div");e.classList.add("textarea__container");const t=document.createElement("textarea");t.name="textarea",t.className="textarea use-keyboard-input",t.cols=r.cols,t.rows=r.rows,t.setAttribute("autofocus","autofocus"),e.append(t),document.body.append(e)}(),l.init(),h("h3","Keyboard created on Windows"),h("h3","For language switch: ctrlLeft + altLeft"),h("h3",`Language now: ${l.language}`,"lang")},window.addEventListener("keydown",(e=>{switch(l.highlightKey(e.key,e.code),e.key){case"Shift":l.toggleShift();break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.preventDefault()}if("ControlLeft"===e.code&&(o[e.code]=!0),o.ControlLeft&&"AltLeft"===e.code){l.switchLanguage();document.getElementById("lang").innerText=`Language now: ${l.language}`}})),window.addEventListener("keyup",(e=>{const t=document.querySelector("textarea"),a=document.querySelector(`.${e.code}`);switch(l.value=t.value,l.removeKeyHighlight(e.key,e.code),"ShiftLeft"===e.code&&delete o[e.code],e.code){case"CapsLock":l.capsLock();break;case"Tab":l.tab();break;case"ShiftRight":case"ShiftLeft":l.toggleShift();break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":l.ordinaryKey(a.textContent)}}))})();